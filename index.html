<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AcoustiSkin CRM Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; background: #f3f4f6; overflow: hidden; }
        .sidebar { width: 260px; background: #1e1b4b; color: white; display: flex; flex-direction: column; height: 100vh; }
        .nav-item { padding: 10px 20px; cursor: pointer; color: #a5b4fc; display: flex; align-items: center; transition: 0.2s; }
        .nav-item:hover, .nav-item.active { background: #312e81; color: white; }
        .nav-item.active { border-left: 4px solid #818cf8; font-weight: 600; }
        .main-content { flex: 1; height: 100vh; overflow-y: auto; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .kanban-col { min-width: 280px; background: #e5e7eb; padding: 10px; border-radius: 8px; height: 100%; }
        .kanban-card { background: white; padding: 10px; margin-bottom: 10px; border-radius: 4px; border-top: 3px solid #4f46e5; cursor: pointer; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 50; }
        .modal-content { background: white; padding: 25px; border-radius: 8px; width: 400px; max-width: 90%; }
        .hidden { display: none; }
    </style>
</head>
<body class="flex">

<aside class="sidebar">
    <div class="p-5 border-b border-indigo-900 font-bold text-lg flex items-center gap-2">
        <div class="bg-indigo-500 w-8 h-8 rounded flex items-center justify-center">AS</div> AcoustiSkin
    </div>
    <div class="flex-1 overflow-y-auto py-2">
        <div class="px-5 py-2 text-xs font-bold text-indigo-400 uppercase">Core</div>
        <div onclick="nav('dashboard')" class="nav-item active" id="btn-dashboard"><i class="fa fa-chart-pie w-6"></i> Dashboard</div>
        <div onclick="nav('customers')" class="nav-item" id="btn-customers"><i class="fa fa-users w-6"></i> Customers</div>
        <div onclick="nav('new-order')" class="nav-item" id="btn-new-order"><i class="fa fa-cart-plus w-6"></i> New Order</div>
        <div onclick="nav('tracking')" class="nav-item" id="btn-tracking"><i class="fa fa-truck w-6"></i> Order Tracking</div>
        <div onclick="nav('calendar')" class="nav-item" id="btn-calendar"><i class="fa fa-calendar w-6"></i> Calendar</div>
        <div onclick="nav('pipeline')" class="nav-item" id="btn-pipeline"><i class="fa fa-filter w-6"></i> Pipeline</div>
        <div onclick="nav('reports')" class="nav-item" id="btn-reports"><i class="fa fa-chart-line w-6"></i> Reports</div>
        <div onclick="nav('vendors')" class="nav-item" id="btn-vendors"><i class="fa fa-briefcase w-6"></i> Vendors</div>
        
        <div class="px-5 py-2 mt-4 text-xs font-bold text-indigo-400 uppercase">Actions</div>
        <div class="px-4 space-y-2">
            <button onclick="openModal('customer')" class="w-full text-left px-3 py-2 bg-indigo-600 hover:bg-indigo-500 text-white text-sm rounded"> + New Customer</button>
            <button onclick="openModal('vendor')" class="w-full text-left px-3 py-2 bg-indigo-800 hover:bg-indigo-700 text-indigo-100 text-sm rounded"> + New Vendor</button>
            <button onclick="openModal('task')" class="w-full text-left px-3 py-2 bg-indigo-900 hover:bg-indigo-800 text-indigo-200 text-sm rounded"> + Quick Task</button>
        </div>
        <div class="px-4 mt-4 flex gap-2">
            <button onclick="exportData()" class="flex-1 bg-slate-600 text-xs py-1 rounded text-white">Export</button>
            <button onclick="resetData()" class="flex-1 bg-red-800 text-xs py-1 rounded text-white">Reset</button>
        </div>
    </div>
    <div class="p-4 bg-indigo-950">
        <div class="text-xs text-indigo-400 font-bold mb-1">ADDRESS BOOK</div>
        <input id="search" onkeyup="renderAddr()" placeholder="Search..." class="w-full bg-indigo-900 border-none text-white text-sm p-2 rounded mb-2">
        <div id="addrList" class="h-24 overflow-y-auto text-sm text-indigo-200"></div>
    </div>
</aside>

<main class="main-content">
    <header class="flex justify-between items-center mb-6">
        <h2 id="pageTitle" class="text-2xl font-bold text-gray-800">Dashboard</h2>
        <div id="ctxBadge" class="hidden items-center bg-white px-3 py-1 rounded-full shadow text-sm">
            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span> Active: <b id="ctxName" class="ml-1 text-indigo-700">Name</b>
            <span onclick="setCtx(null)" class="ml-3 cursor-pointer text-gray-400 hover:text-red-500">x</span>
        </div>
    </header>
    <div id="view-container"></div>
</main>

<div id="modal" class="modal">
    <div class="modal-content">
        <div class="flex justify-between mb-4"><h3 id="mTitle" class="font-bold text-lg">Title</h3><button onclick="closeModal()">x</button></div>
        <div id="mBody"></div>
    </div>
</div>

<script>
    let db = { customers: [], orders: [], tasks: [], pipeline: [], vendors: [], ctx: null };

    // INIT
    window.onload = () => {
        if(localStorage.getItem('crm_v3')) db = JSON.parse(localStorage.getItem('crm_v3'));
        else seed();
        renderAddr();
        updateCtx();
        nav('dashboard');
    };

    function seed() {
        db = {
            customers: [{id:'c1', name:'Pickleball Kingdom', email:'buy@pb.com', type:'Wholesale'}, {id:'c2', name:'Dana Lurie', email:'dana@test.com', type:'Internal'}],
            orders: [{id:'101', cName:'Pickleball Kingdom', total:500, status:'Shipped'}],
            tasks: [{id:'t1', title:'Call FedEx', date:'2025-10-24'}],
            pipeline: [{id:'p1', title:'Bulk Order', val:5000, stage:'Negotiation'}],
            vendors: [{name:'3M Supplies', type:'Materials'}],
            ctx: null
        };
        save();
    }

    function save() { localStorage.setItem('crm_v3', JSON.stringify(db)); renderAddr(); updateCtx(); }
    function resetData() { if(confirm('Reset all data?')) { localStorage.removeItem('crm_v3'); location.reload(); } }
    function exportData() { 
        const a = document.createElement('a'); a.href = 'data:text/json;charset=utf-8,'+encodeURIComponent(JSON.stringify(db));
        a.download = 'backup.json'; document.body.appendChild(a); a.click(); 
    }

    // NAV
    function nav(view) {
        document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
        document.getElementById('btn-'+view).classList.add('active');
        document.getElementById('pageTitle').innerText = view.charAt(0).toUpperCase() + view.slice(1);
        const c = document.getElementById('view-container');
        
        if(view==='dashboard') {
            const rev = db.orders.reduce((a,b)=>a+b.total,0);
            c.innerHTML = `
            <div class="grid grid-cols-4 gap-4 mb-6">
                <div class="card border-l-4 border-indigo-500"> <div class="text-xs text-gray-500">REVENUE</div> <div class="text-2xl font-bold">$${rev}</div> </div>
                <div class="card border-l-4 border-green-500"> <div class="text-xs text-gray-500">CUSTOMERS</div> <div class="text-2xl font-bold">${db.customers.length}</div> </div>
                <div class="card border-l-4 border-blue-500"> <div class="text-xs text-gray-500">PIPELINE</div> <div class="text-2xl font-bold">${db.pipeline.length}</div> </div>
                <div class="card border-l-4 border-orange-500"> <div class="text-xs text-gray-500">TASKS</div> <div class="text-2xl font-bold">${db.tasks.length}</div> </div>
            </div>
            <div class="card"><h3>Recent Activity</h3>${db.orders.map(o=>`<div class="flex justify-between border-b py-2"><span>Order #${o.id} - ${o.cName}</span><b>$${o.total}</b></div>`).join('')}</div>`;
        }
        else if(view==='customers') {
            c.innerHTML = `<div class="card"><table class="w-full text-left"><thead><tr class="bg-gray-100"><th>Name</th><th>Email</th><th>Type</th><th>Action</th></tr></thead>
            <tbody>${db.customers.map(x=>`<tr><td class="p-2 font-bold text-indigo-700 cursor-pointer" onclick="setCtx('${x.id}')">${x.name}</td><td class="p-2">${x.email}</td><td class="p-2">${x.type}</td><td class="p-2"><button onclick="setCtx('${x.id}');nav('new-order')" class="text-blue-600">Order</button></td></tr>`).join('')}</tbody></table></div>`;
        }
        else if(view==='new-order') {
            const cust = db.customers.find(x=>x.id===db.ctx);
            if(!cust) { c.innerHTML = `<div class="card text-center text-red-500 font-bold py-10">Select a customer first.</div>`; return; }
            c.innerHTML = `<div class="card max-w-lg mx-auto"><h3 class="font-bold mb-4">Order for ${cust.name}</h3>
            <label>Product</label><select id="oProd" class="w-full border p-2 mb-4 rounded"><option value="29.95">Skin ($29.95)</option><option value="150">Bulk ($150)</option></select>
            <label>Qty</label><input id="oQty" type="number" value="1" class="w-full border p-2 mb-4 rounded">
            <button onclick="addOrder()" class="w-full bg-green-600 text-white py-2 rounded font-bold">Submit</button></div>`;
        }
        else if(view==='tracking') {
            c.innerHTML = `<div class="card"><table class="w-full text-left"><thead><tr class="bg-gray-100"><th>ID</th><th>Customer</th><th>Status</th><th>Total</th></tr></thead>
            <tbody>${db.orders.map(o=>`<tr><td class="p-2">#${o.id}</td><td class="p-2">${o.cName}</td><td class="p-2"><span class="bg-green-100 text-green-800 px-2 rounded text-xs">${o.status}</span></td><td class="p-2">$${o.total}</td></tr>`).join('')}</tbody></table></div>`;
        }
        else if(view==='calendar') {
            c.innerHTML = `<div class="card"><h3 class="font-bold mb-4">Tasks</h3>${db.tasks.map(t=>`<div class="flex justify-between border-b py-2"><span>${t.title} <span class="text-xs text-gray-500">${t.date}</span></span><button onclick="delTask('${t.id}')" class="text-red-500">x</button></div>`).join('')}</div>`;
        }
        else if(view==='pipeline') {
            const stages = ['Lead','Negotiation','Closed Won'];
            c.innerHTML = `<div class="flex gap-4 h-[500px] overflow-x-auto">${stages.map(s=>`<div class="kanban-col"><div class="font-bold mb-2 uppercase text-xs text-gray-500">${s}</div>
            ${db.pipeline.filter(p=>p.stage===s).map(p=>`<div class="kanban-card"><b>${p.title}</b><br>$${p.val}<br>${s!=='Closed Won'?`<button onclick="movePipe('${p.id}')" class="text-xs text-blue-500 mt-2">Advance</button>`:''}</div>`).join('')}</div>`).join('')}</div>`;
        }
        else if(view==='vendors') {
            c.innerHTML = `<div class="card"><h3 class="font-bold mb-4">Vendors</h3>${db.vendors.map(v=>`<div class="border-b py-2">${v.name} <span class="text-xs text-gray-500">${v.type}</span></div>`).join('')}</div>`;
        }
        else if(view==='reports') {
            c.innerHTML = `<div class="card"><h3 class="font-bold mb-2">Performance</h3><p>Total Orders: ${db.orders.length}</p><p>Total Revenue: $${db.orders.reduce((a,b)=>a+b.total,0)}</p></div>`;
        }
    }

    // ACTIONS
    function setCtx(id) { db.ctx = id; save(); }
    function updateCtx() { 
        const el = document.getElementById('ctxBadge');
        if(db.ctx) { 
            const c = db.customers.find(x=>x.id===db.ctx); 
            document.getElementById('ctxName').innerText = c?c.name:'Unknown'; 
            el.style.display = 'inline-flex';
        } else { el.style.display = 'none'; }
    }
    function renderAddr() {
        const term = document.getElementById('search').value.toLowerCase();
        document.getElementById('addrList').innerHTML = db.customers.filter(c=>c.name.toLowerCase().includes(term)).map(c=>
            `<div class="p-1 hover:bg-indigo-800 cursor-pointer rounded" onclick="setCtx('${c.id}')">${c.name}</div>`
        ).join('');
    }
    function openModal(type) {
        document.getElementById('modal').style.display = 'flex';
        const b = document.getElementById('mBody');
        document.getElementById('mTitle').innerText = 'New ' + type;
        if(type==='customer') b.innerHTML = `<input id="inp1" placeholder="Name" class="w-full border p-2 mb-2"><input id="inp2" placeholder="Email" class="w-full border p-2 mb-2"><button onclick="saveCust()" class="w-full bg-indigo-600 text-white p-2 rounded">Save</button>`;
        if(type==='vendor') b.innerHTML = `<input id="inp1" placeholder="Name" class="w-full border p-2 mb-2"><input id="inp2" placeholder="Type" class="w-full border p-2 mb-2"><button onclick="saveVend()" class="w-full bg-indigo-600 text-white p-2 rounded">Save</button>`;
        if(type==='task') b.innerHTML = `<input id="inp1" placeholder="Task" class="w-full border p-2 mb-2"><input type="date" id="inp2" class="w-full border p-2 mb-2"><button onclick="saveTask()" class="w-full bg-indigo-600 text-white p-2 rounded">Save</button>`;
    }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    
    function saveCust() { db.customers.push({id:'c'+Date.now(), name:document.getElementById('inp1').value, email:document.getElementById('inp2').value, type:'Wholesale'}); save(); closeModal(); nav('customers'); }
    function saveVend() { db.vendors.push({name:document.getElementById('inp1').value, type:document.getElementById('inp2').value}); save(); closeModal(); nav('vendors'); }
    function saveTask() { db.tasks.push({id:'t'+Date.now(), title:document.getElementById('inp1').value, date:document.getElementById('inp2').value}); save(); closeModal(); nav('calendar'); }
    function delTask(id) { db.tasks = db.tasks.filter(t=>t.id!==id); save(); nav('calendar'); }
    function addOrder() {
        const c = db.customers.find(x=>x.id===db.ctx);
        const tot = document.getElementById('oProd').value * document.getElementById('oQty').value;
        db.orders.unshift({id:Math.floor(Math.random()*1000), cName:c.name, total:tot, status:'Processing'});
        save(); alert('Order Created'); nav('tracking');
    }
    function movePipe(id) { const p = db.pipeline.find(x=>x.id===id); if(p.stage==='Lead') p.stage='Negotiation'; else p.stage='Closed Won'; save(); nav('pipeline'); }
</script>
</body>
</html>
